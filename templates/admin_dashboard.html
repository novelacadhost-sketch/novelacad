<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            background: var(--light);
        }

        .preview-note {
            margin-bottom: 12px;
            color: #6B6A75
        }
    </style>
</head>

<body>
    <main style="padding:40px;">
        <div class="registration-form-wrapper" style="max-width:1100px;margin:0 auto;">
            <div class="admin-header">
                <div>
                    <h1 style="margin:0;color:var(--dark)">Admin Dashboard</h1>
                    <p style="margin:0;color:#6B6A75">View all form submissions.</p>
                </div>
                <div>
                    <a href="{{ url_for('home') }}" style="margin-right:12px;color:var(--primary);">View site</a>
                    <a href="{{ url_for('admin_logout') }}" class="logout-btn">Logout</a>
                </div>
            </div>

            <div class="admin-tables" style="margin-top: 30px;">
                <section class="card">
                    <h2 style="margin-top:0;color:var(--dark)">Registrations</h2>
                    <div style="overflow-x:auto;">
                        <table class="table" style="min-width: 600px;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Course</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reg in registrations %}
                                <tr>
                                    <td>{{ reg.id }}</td>
                                    <td>{{ reg.full_name }}</td>
                                    <td>{{ reg.course }}</td>
                                    <td>{{ reg.submitted_at }}</td>
                                    <td>
                                        <a href="{{ url_for('registration_details', reg_id=reg.id) }}"
                                            class="btn-submit"
                                            style="padding:5px 10px; font-size:0.8rem; text-decoration:none;">View</a>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="6" style="text-align:center;">No registrations found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="card" style="margin-top: 30px;">
                    <h2 style="margin-top:0;color:var(--dark)">Contact Messages</h2>
                    <div style="overflow-x:auto;">
                        <table class="table" style="min-width: 600px;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Subject</th>
                                    <th>Message</th>
                                    <th>Submitted</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for msg in messages %}
                                <tr>
                                    <td>{{ msg.id }}</td>
                                    <td>{{ msg.name }}</td>
                                    <td>{{ msg.email }}</td>
                                    <td>{{ msg.subject }}</td>
                                    <td>{{ msg.message }}</td>
                                    <td>{{ msg.submitted_at }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="6" style="text-align:center;">No messages found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Admin Management Section (Master Admin Only) -->
                {% if session.get('admin_role') == 'master' %}
                <section class="card" style="margin-top: 30px;">
                    <h2 style="margin-top:0;color:var(--dark)">Manage Admins</h2>

                    <div style="display:flex; flex-wrap:wrap; gap:30px;">
                        <!-- List Admins -->
                        <div style="flex:1; min-width:300px;">
                            <h3 style="font-size:1.2rem; margin-bottom:15px; color:var(--primary);">Existing Admins</h3>
                            <table class="table" style="width:100%;">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for admin in admins %}
                                    <tr>
                                        <td>{{ admin.id }}</td>
                                        <td>{{ admin.username }}</td>
                                        <td>{{ admin.email }}</td>
                                        <td>
                                            {% if admin.role == 'master' %}
                                            <span
                                                style="background:var(--primary); color:#fff; padding:2px 6px; border-radius:4px; font-size:0.8rem;">Master</span>
                                            {% else %}
                                            <span
                                                style="background:#eee; color:#666; padding:2px 6px; border-radius:4px; font-size:0.8rem;">Admin</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if admin.role != 'master' %}
                                            <form action="{{ url_for('delete_admin', admin_id=admin.id) }}"
                                                method="POST"
                                                onsubmit="return confirm('Are you sure you want to delete this admin?');"
                                                style="display:inline;">
                                                <button type="submit"
                                                    style="background:none; border:none; color:red; cursor:pointer; text-decoration:underline; font-size:0.9rem;">Delete</button>
                                            </form>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Create Admin Form (Master Admin Only) -->
                        <div style="flex:1; min-width:300px;">
                            <h3 style="font-size:1.2rem; margin-bottom:15px; color:var(--primary);">Create New Admin
                            </h3>
                            <form method="POST" action="{{ url_for('create_admin') }}"
                                style="background:#f8f9fa; padding:20px; border-radius:8px;">
                                <div class="form-group" style="margin-bottom:15px;">
                                    <label for="new_username">Username</label>
                                    <input type="text" id="new_username" name="username" class="form-control" required>
                                </div>
                                <div class="form-group" style="margin-bottom:15px;">
                                    <label for="new_email">Email</label>
                                    <input type="email" id="new_email" name="email" class="form-control" required>
                                </div>
                                <div class="form-group" style="margin-bottom:15px;">
                                    <label for="new_password">Password</label>
                                    <input type="password" id="new_password" name="password" class="form-control"
                                        required>
                                </div>
                                <button type="submit" class="btn-submit" style="width:100%; padding: 10px;">Create
                                    Admin</button>
                            </form>
                        </div>
                    </div>
                </section>
                {% endif %}
            </div>
        </div>
    </main>
</body>

</html>